<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Journal - Cloud Hosted</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/recharts@2.5.0/dist/Recharts.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } = Recharts;

        function TradingJournal() {
            const [trades, setTrades] = useState([]);
            const [loading, setLoading] = useState(true);
            const [view, setView] = useState('add');
            const [editingId, setEditingId] = useState(null);
            const [formData, setFormData] = useState({
                date: new Date().toISOString().split('T')[0],
                symbol: '',
                type: 'Long',
                entryPrice: '',
                exitPrice: '',
                quantity: '',
                notes: '',
                strategy: '',
                outcome: 'Win'
            });

            useEffect(() => {
                loadTrades();
            }, []);

            function loadTrades() {
                try {
                    setLoading(true);
                    const saved = localStorage.getItem('trading-journal-data');
                    if (saved) {
                        setTrades(JSON.parse(saved));
                    }
                } catch (error) {
                    console.log('No existing trades found');
                } finally {
                    setLoading(false);
                }
            }

            function saveTrades(updatedTrades) {
                try {
                    localStorage.setItem('trading-journal-data', JSON.stringify(updatedTrades));
                    setTrades(updatedTrades);
                } catch (error) {
                    alert('Error saving trade: ' + error.message);
                }
            }

            function handleInputChange(e) {
                const { name, value } = e.target;
                setFormData(prev => ({ ...prev, [name]: value }));
            }

            function calculatePnL(entry, exit, quantity, type) {
                const entryNum = parseFloat(entry) || 0;
                const exitNum = parseFloat(exit) || 0;
                const qtyNum = parseFloat(quantity) || 0;
                
                if (type === 'Long') {
                    return (exitNum - entryNum) * qtyNum;
                } else {
                    return (entryNum - exitNum) * qtyNum;
                }
            }

            function handleSubmit(e) {
                e.preventDefault();
                
                const pnl = calculatePnL(formData.entryPrice, formData.exitPrice, formData.quantity, formData.type);
                const newTrade = {
                    id: editingId || Date.now().toString(),
                    ...formData,
                    pnl: pnl.toFixed(2),
                    entryPrice: parseFloat(formData.entryPrice),
                    exitPrice: parseFloat(formData.exitPrice),
                    quantity: parseFloat(formData.quantity)
                };

                let updatedTrades;
                if (editingId) {
                    updatedTrades = trades.map(t => t.id === editingId ? newTrade : t);
                    setEditingId(null);
                } else {
                    updatedTrades = [newTrade, ...trades];
                }

                saveTrades(updatedTrades);
                
                setFormData({
                    date: new Date().toISOString().split('T')[0],
                    symbol: '',
                    type: 'Long',
                    entryPrice: '',
                    exitPrice: '',
                    quantity: '',
                    notes: '',
                    strategy: '',
                    outcome: 'Win'
                });
                
                setView('history');
            }

            function editTrade(trade) {
                setFormData({
                    date: trade.date,
                    symbol: trade.symbol,
                    type: trade.type,
                    entryPrice: trade.entryPrice.toString(),
                    exitPrice: trade.exitPrice.toString(),
                    quantity: trade.quantity.toString(),
                    notes: trade.notes || '',
                    strategy: trade.strategy || '',
                    outcome: trade.outcome
                });
                setEditingId(trade.id);
                setView('add');
            }

            function deleteTrade(id) {
                if (window.confirm('Are you sure you want to delete this trade?')) {
                    const updatedTrades = trades.filter(t => t.id !== id);
                    saveTrades(updatedTrades);
                }
            }

            function exportData() {
                const dataStr = JSON.stringify(trades, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `trading-journal-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
            }

            function importData(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        try {
                            const imported = JSON.parse(event.target.result);
                            if (window.confirm(`Import ${imported.length} trades? This will replace your current data.`)) {
                                saveTrades(imported);
                                alert('Data imported successfully!');
                            }
                        } catch (error) {
                            alert('Error importing data: ' + error.message);
                        }
                    };
                    reader.readAsText(file);
                }
            }

            function getStats() {
                const totalPnL = trades.reduce((sum, t) => sum + parseFloat(t.pnl), 0);
                const wins = trades.filter(t => parseFloat(t.pnl) > 0).length;
                const losses = trades.filter(t => parseFloat(t.pnl) < 0).length;
                const winRate = trades.length > 0 ? ((wins / trades.length) * 100).toFixed(1) : 0;
                const avgWin = wins > 0 ? trades.filter(t => parseFloat(t.pnl) > 0).reduce((sum, t) => sum + parseFloat(t.pnl), 0) / wins : 0;
                const avgLoss = losses > 0 ? trades.filter(t => parseFloat(t.pnl) < 0).reduce((sum, t) => sum + parseFloat(t.pnl), 0) / losses : 0;

                return { totalPnL, wins, losses, winRate, avgWin, avgLoss };
            }

            function getChartData() {
                let cumulative = 0;
                return [...trades].reverse().map(trade => {
                    cumulative += parseFloat(trade.pnl);
                    return {
                        date: trade.date,
                        pnl: cumulative
                    };
                });
            }

            const stats = getStats();

            if (loading) {
                return (
                    <div className="min-h-screen bg-gray-900 text-white flex items-center justify-center">
                        <div className="text-xl">Loading your trading journal...</div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gray-900 text-white">
                    <div className="max-w-7xl mx-auto p-4">
                        <div className="flex justify-between items-center mb-6">
                            <h1 className="text-4xl font-bold bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">
                                Trading Journal
                            </h1>
                            <div className="flex gap-2">
                                <button
                                    onClick={exportData}
                                    className="px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg text-sm font-semibold transition"
                                >
                                    Export Data
                                </button>
                                <label className="px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg text-sm font-semibold transition cursor-pointer">
                                    Import Data
                                    <input type="file" accept=".json" onChange={importData} className="hidden" />
                                </label>
                            </div>
                        </div>

                        <div className="flex gap-2 mb-6 flex-wrap">
                            <button
                                onClick={() => setView('add')}
                                className={`px-6 py-2 rounded-lg font-semibold transition ${
                                    view === 'add' ? 'bg-blue-600 text-white' : 'bg-gray-700 hover:bg-gray-600'
                                }`}
                            >
                                {editingId ? 'Edit Trade' : 'Add Trade'}
                            </button>
                            <button
                                onClick={() => setView('history')}
                                className={`px-6 py-2 rounded-lg font-semibold transition ${
                                    view === 'history' ? 'bg-blue-600 text-white' : 'bg-gray-700 hover:bg-gray-600'
                                }`}
                            >
                                Trade History
                            </button>
                            <button
                                onClick={() => setView('stats')}
                                className={`px-6 py-2 rounded-lg font-semibold transition ${
                                    view === 'stats' ? 'bg-blue-600 text-white' : 'bg-gray-700 hover:bg-gray-600'
                                }`}
                            >
                                Statistics
                            </button>
                        </div>

                        {view === 'add' && (
                            <div className="bg-gray-800 rounded-lg p-6 shadow-xl">
                                <h2 className="text-2xl font-bold mb-4">{editingId ? 'Edit Trade' : 'Add New Trade'}</h2>
                                <form onSubmit={handleSubmit} className="space-y-4">
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Date</label>
                                            <input
                                                type="date"
                                                name="date"
                                                value={formData.date}
                                                onChange={handleInputChange}
                                                required
                                                className="w-full px-4 py-2 bg-gray-700 text-white rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Symbol</label>
                                            <input
                                                type="text"
                                                name="symbol"
                                                value={formData.symbol}
                                                onChange={handleInputChange}
                                                placeholder="e.g., AAPL, EURUSD"
                                                required
                                                className="w-full px-4 py-2 bg-gray-700 text-white rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                                            />
                                        </div>
                                    </div>

                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Trade Type</label>
                                            <select
                                                name="type"
                                                value={formData.type}
                                                onChange={handleInputChange}
                                                className="w-full px-4 py-2 bg-gray-700 text-white rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                                            >
                                                <option value="Long">Long</option>
                                                <option value="Short">Short</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Outcome</label>
                                            <select
                                                name="outcome"
                                                value={formData.outcome}
                                                onChange={handleInputChange}
                                                className="w-full px-4 py-2 bg-gray-700 text-white rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                                            >
                                                <option value="Win">Win</option>
                                                <option value="Loss">Loss</option>
                                                <option value="Breakeven">Breakeven</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Entry Price</label>
                                            <input
                                                type="number"
                                                name="entryPrice"
                                                value={formData.entryPrice}
                                                onChange={handleInputChange}
                                                step="0.01"
                                                placeholder="0.00"
                                                required
                                                className="w-full px-4 py-2 bg-gray-700 text-white rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Exit Price</label>
                                            <input
                                                type="number"
                                                name="exitPrice"
                                                value={formData.exitPrice}
                                                onChange={handleInputChange}
                                                step="0.01"
                                                placeholder="0.00"
                                                required
                                                className="w-full px-4 py-2 bg-gray-700 text-white rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Quantity</label>
                                            <input
                                                type="number"
                                                name="quantity"
                                                value={formData.quantity}
                                                onChange={handleInputChange}
                                                step="0.01"
                                                placeholder="0"
                                                required
                                                className="w-full px-4 py-2 bg-gray-700 text-white rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                                            />
                                        </div>
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium mb-2">Strategy</label>
                                        <input
                                            type="text"
                                            name="strategy"
                                            value={formData.strategy}
                                            onChange={handleInputChange}
                                            placeholder="e.g., Breakout, Mean Reversion, Trend Following"
                                            className="w-full px-4 py-2 bg-gray-700 text-white rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium mb-2">Notes</label>
                                        <textarea
                                            name="notes"
                                            value={formData.notes}
                                            onChange={handleInputChange}
                                            placeholder="What went well? What could be improved?"
                                            rows="4"
                                            className="w-full px-4 py-2 bg-gray-700 text-white rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                                        />
                                    </div>

                                    <div className="flex gap-3">
                                        <button
                                            type="submit"
                                            className="px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold transition"
                                        >
                                            {editingId ? 'Update Trade' : 'Save Trade'}
                                        </button>
                                        {editingId && (
                                            <button
                                                type="button"
                                                onClick={() => {
                                                    setEditingId(null);
                                                    setFormData({
                                                        date: new Date().toISOString().split('T')[0],
                                                        symbol: '',
                                                        type: 'Long',
                                                        entryPrice: '',
                                                        exitPrice: '',
                                                        quantity: '',
                                                        notes: '',
                                                        strategy: '',
                                                        outcome: 'Win'
                                                    });
                                                }}
                                                className="px-6 py-3 bg-gray-600 hover:bg-gray-700 rounded-lg font-semibold transition"
                                            >
                                                Cancel
                                            </button>
                                        )}
                                    </div>
                                </form>
                            </div>
                        )}

                        {view === 'history' && (
                            <div className="bg-gray-800 rounded-lg p-6 shadow-xl">
                                <h2 className="text-2xl font-bold mb-4">Trade History ({trades.length} trades)</h2>
                                {trades.length === 0 ? (
                                    <p className="text-gray-400 text-center py-8">No trades recorded yet. Add your first trade!</p>
                                ) : (
                                    <div className="overflow-x-auto">
                                        <table className="w-full">
                                            <thead>
                                                <tr className="border-b border-gray-700">
                                                    <th className="text-left py-3 px-2">Date</th>
                                                    <th className="text-left py-3 px-2">Symbol</th>
                                                    <th className="text-left py-3 px-2">Type</th>
                                                    <th className="text-right py-3 px-2">Entry</th>
                                                    <th className="text-right py-3 px-2">Exit</th>
                                                    <th className="text-right py-3 px-2">Qty</th>
                                                    <th className="text-right py-3 px-2">P&L</th>
                                                    <th className="text-center py-3 px-2">Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {trades.map(trade => (
                                                    <tr key={trade.id} className="border-b border-gray-700 hover:bg-gray-750">
                                                        <td className="py-3 px-2">{trade.date}</td>
                                                        <td className="py-3 px-2 font-semibold">{trade.symbol}</td>
                                                        <td className="py-3 px-2">
                                                            <span className={`px-2 py-1 rounded text-xs ${
                                                                trade.type === 'Long' ? 'bg-green-900 text-green-300' : 'bg-red-900 text-red-300'
                                                            }`}>
                                                                {trade.type}
                                                            </span>
                                                        </td>
                                                        <td className="text-right py-3 px-2">${trade.entryPrice.toFixed(2)}</td>
                                                        <td className="text-right py-3 px-2">${trade.exitPrice.toFixed(2)}</td>
                                                        <td className="text-right py-3 px-2">{trade.quantity}</td>
                                                        <td className={`text-right py-3 px-2 font-bold ${
                                                            parseFloat(trade.pnl) > 0 ? 'text-green-400' : parseFloat(trade.pnl) < 0 ? 'text-red-400' : 'text-gray-400'
                                                        }`}>
                                                            ${parseFloat(trade.pnl).toFixed(2)}
                                                        </td>
                                                        <td className="text-center py-3 px-2">
                                                            <button
                                                                onClick={() => editTrade(trade)}
                                                                className="px-3 py-1 bg-blue-600 hover:bg-blue-700 rounded mr-2 text-sm"
                                                            >
                                                                Edit
                                                            </button>
                                                            <button
                                                                onClick={() => deleteTrade(trade.id)}
                                                                className="px-3 py-1 bg-red-600 hover:bg-red-700 rounded text-sm"
                                                            >
                                                                Delete
                                                            </button>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                )}
                            </div>
                        )}

                        {view === 'stats' && (
                            <div className="space-y-6">
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div className="bg-gray-800 rounded-lg p-6 shadow-xl">
                                        <h3 className="text-gray-400 text-sm mb-2">Total P&L</h3>
                                        <p className={`text-3xl font-bold ${
                                            stats.totalPnL > 0 ? 'text-green-400' : stats.totalPnL < 0 ? 'text-red-400' : 'text-gray-400'
                                        }`}>
                                            ${stats.totalPnL.toFixed(2)}
                                        </p>
                                    </div>
                                    <div className="bg-gray-800 rounded-lg p-6 shadow-xl">
                                        <h3 className="text-gray-400 text-sm mb-2">Win Rate</h3>
                                        <p className="text-3xl font-bold">{stats.winRate}%</p>
                                        <p className="text-sm text-gray-400 mt-1">{stats.wins}W / {stats.losses}L</p>
                                    </div>
                                    <div className="bg-gray-800 rounded-lg p-6 shadow-xl">
                                        <h3 className="text-gray-400 text-sm mb-2">Total Trades</h3>
                                        <p className="text-3xl font-bold">{trades.length}</p>
                                    </div>
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div className="bg-gray-800 rounded-lg p-6 shadow-xl">
                                        <h3 className="text-gray-400 text-sm mb-2">Average Win</h3>
                                        <p className="text-2xl font-bold text-green-400">${stats.avgWin.toFixed(2)}</p>
                                    </div>
                                    <div className="bg-gray-800 rounded-lg p-6 shadow-xl">
                                        <h3 className="text-gray-400 text-sm mb-2">Average Loss</h3>
                                        <p className="text-2xl font-bold text-red-400">${stats.avgLoss.toFixed(2)}</p>
                                    </div>
                                </div>

                                {trades.length > 0 && (
                                    <div className="bg-gray-800 rounded-lg p-6 shadow-xl">
                                        <h3 className="text-xl font-bold mb-4">Cumulative P&L</h3>
                                        <ResponsiveContainer width="100%" height={300}>
                                            <LineChart data={getChartData()}>
                                                <CartesianGrid strokeDasharray="3 3" stroke="#374151" />
                                                <XAxis dataKey="date" stroke="#9CA3AF" />
                                                <YAxis stroke="#9CA3AF" />
                                                <Tooltip 
                                                    contentStyle={{ backgroundColor: '#1F2937', border: 'none', borderRadius: '8px' }}
                                                    labelStyle={{ color: '#9CA3AF' }}
                                                />
                                                <Line type="monotone" dataKey="pnl" stroke="#3B82F6" strokeWidth={2} dot={{ fill: '#3B82F6' }} />
                                            </LineChart>
                                        </ResponsiveContainer>
                                    </div>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<TradingJournal />);
    </script>
</body>
</html>
